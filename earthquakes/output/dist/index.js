define(["esri/Map","esri/views/MapView","esri/layers/GeoJSONLayer","esri/widgets/TimeSlider","esri/widgets/Expand","esri/widgets/Legend"],(function(e,t,a,s,n,i){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,a=a&&a.hasOwnProperty("default")?a.default:a,s=s&&s.hasOwnProperty("default")?s.default:s,n=n&&n.hasOwnProperty("default")?n.default:n,i=i&&i.hasOwnProperty("default")?i.default:i;const o=()=>{},l=new p5.SoundFile("assets/hh_sample.mp3",o),d=new p5.SoundFile("assets/clap_sample.mp3",o),r=new p5.SoundFile("assets/bass_sample.mp3",o),c=new p5.SoundFile("assets/snare_ups_sample.mp3",o),p=[0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],u=[0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0],m=[1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],g=[0,1,0,0,0,1,0,0,1,0,1,0,0,0,1,0];let f,h,y;const w=document.getElementById("hh"),v=document.getElementById("clap"),x=document.getElementById("bass"),b=document.getElementById("snare");window.setup=function(){console.log("setup");const o=new p5.Phrase("hh",e=>{w.checked&&(f.play(null),l.play(e))},p),E=new p5.Phrase("clap",e=>{v.checked&&d.play(e)},u);let S=0;const _=new p5.Phrase("bass",e=>{if(x.checked&&(f.play(null),r.play(e),h&&h.effect)){const e=h.effect.clone();y&&"playing"===y.viewModel.state?e.includedEffect="contrast(500%)":0===S?(e.includedEffect="contrast(500%)",S=1):(e.includedEffect=null,S=0),h.effect=e}},m),F=new p5.Phrase("snare",e=>{b.checked&&(f.play(null),c.play(e))},g),I=new p5.Part;I.addPhrase(o),I.addPhrase(E),I.addPhrase(_),I.addPhrase(F);const P=new p5.Delay;I.setBPM(60),P.process(l,.5,.3,1500),P.process(d,.12,.8,1e3),P.process(c,.1,.6,2e3);const k=new p5.Reverb;k.process(l,3,2),k.process(c,3,2),k.process(d,3,2),f=new p5.Envelope,f.setADSR(.01,.8,.2,.5),f.setRange(1,.5),r.amp(f),l.amp(f),c.amp(f),d.amp(f);const M=document.getElementById("btn"),L=document.getElementById("audioIcon"),T=new a({url:"https://bsvensson.github.io/various-tests/geojson/usgs-earthquakes-06182019.geojson",copyright:"USGS Earthquakes",title:"USGS Earthquakes",timeInfo:{startField:"time",interval:{unit:"days",value:1}},renderer:{type:"simple",field:"mag",symbol:{type:"simple-marker",color:"orange",outline:null},visualVariables:[{type:"size",field:"mag",stops:[{value:1,size:"5px"},{value:2,size:"15"},{value:3,size:"35"}]},{type:"color",field:"depth",stops:[{value:2.5,color:"#F9C653",label:"<2km"},{value:3.5,color:"#F8864D",label:"3km"},{value:4,color:"#C53C06",label:">4km"}]}]},popupTemplate:{title:"{title}",content:[{type:"fields",fieldInfos:[{fieldName:"place",label:"Location",visible:!0},{fieldName:"mag",label:"Magnitude",visible:!0},{fieldName:"depth",label:"Depth",visible:!0}]}]}}),D=new e({basemap:"dark-gray-vector",layers:[T]}),B=new t({map:D,container:"viewDiv",zoom:13,center:[-117.50268,34.04713]});y=new s({container:"timeSlider",playRate:50,stops:{interval:{value:1,unit:"hours"}}}),B.ui.add(y,"manual"),B.ui.add(M,"top-left"),B.ui.add("audioList","top-left"),B.whenLayerView(T).then((function(e){h=e;const t=new Date(2019,4,25);y.fullTimeExtent={start:t,end:T.timeInfo.fullTimeExtent.end};const a=new Date(t);a.setDate(a.getDate()+1),y.values=[t,a]})),y.watch("timeExtent",()=>{T.definitionExpression="time <= "+y.timeExtent.end.getTime(),h.effect={filter:{timeExtent:y.timeExtent,geometry:B.extent},excludedEffect:"grayscale(20%) opacity(12%)"};const e=h.effect.filter.createQuery();e.outStatistics=[A,C,O,q,N],T.queryFeatures(e).then(e=>{const t=[];if(G.innerHTML="",e.error)return e.error;if(e.features.length>=1&&e.features[0].attributes.tremor_count>0){const a=e.features[0].attributes,s=a.Max_magnitude,n=a.Min_magnitude,i=a.Average_magnitude,o=a.tremor_count,r=1e3*s,p=n>1?.9:n,u=.1*i;for(const e in z)if(a[e]&&null!=a[e]){const s="<br/>"+z[e]+": <b><span> "+a[e].toFixed(2)+"</span></b>";t.push(s)}P.process(l,u,p,r),P.process(d,u,p,r),P.process(c,u,p,r),I.setBPM(o);const m="<span>"+e.features[0].attributes.tremor_count+"</span> earthquakes were recorded between "+y.timeExtent.start.toLocaleDateString()+" - "+y.timeExtent.end.toLocaleDateString()+".<br/>";null==t[0]?G.innerHTML=m:G.innerHTML=m+t[0]+t[1]+t[2]+t[3]}}).catch((function(e){console.log(e)}))});const N={onStatisticField:"depth",outStatisticFieldName:"Average_depth",statisticType:"avg"},A={onStatisticField:"mag",outStatisticFieldName:"Max_magnitude",statisticType:"max"},C={onStatisticField:"mag",outStatisticFieldName:"Average_magnitude",statisticType:"avg"},O={onStatisticField:"mag",outStatisticFieldName:"Min_magnitude",statisticType:"min"},q={onStatisticField:"mag",outStatisticFieldName:"tremor_count",statisticType:"count"},z={Max_magnitude:"Max magnitude",Average_magnitude:"Average magnitude",Min_magnitude:"Min magnitude",Average_depth:"Average Depth"},R=new n({collapsedIconClass:"esri-icon-collapse",expandIconClass:"esri-icon-expand",expandTooltip:"Legend",view:B,content:new i({view:B}),expanded:!1});B.ui.add(R,"top-left");const G=document.getElementById("statsDiv"),H=document.getElementById("infoDiv"),V=new n({collapsedIconClass:"esri-icon-collapse",expandIconClass:"esri-icon-expand",expandTooltip:"Expand earthquakes info",view:B,content:H,expanded:!0});B.ui.add(V,"top-right"),M.addEventListener("click",()=>{l.isLoaded()&&d.isLoaded()&&r.isLoaded()&&(I.isPlaying?(console.log("stop music"),L.src="assets/speaker_Icon.svg",I.stop()):(console.log("start music"),L.src="assets/speaker_mute_Icon.svg",I.loop()))})}}));
